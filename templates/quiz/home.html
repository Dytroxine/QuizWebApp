{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
    .top-block {
        position: absolute;
        top: 0; /* –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        left: 0;
        height: 115vh;
        width: 100%; /* –®–∏—Ä–∏–Ω–∞ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        background-color: #0B0B0B;
    }
    .hidden {
    display: none !important;
}

    .choice-button.selected::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border: 2px solid #7F7F7F; /* –¶–≤–µ—Ç –æ–±–≤–æ–¥–∫–∏ */
    border-radius: 16px; /* –†–∞–¥–∏—É—Å –æ–±–≤–æ–¥–∫–∏ */
    pointer-events: none; /* –ß—Ç–æ–±—ã –æ–±–≤–æ–¥–∫–∞ –Ω–µ –º–µ—à–∞–ª–∞ –∫–ª–∏–∫–∞–º */
    box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ–º –æ–±–≤–æ–¥–∫—É –≤–Ω—É—Ç—Ä–∏ */
}
@keyframes blink {
    0% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
    100% {
        opacity: 1;
    }
}

    .banner {
            position: absolute;
            top: 16px;
            left: 16px;
            width: 358px;
            height: 192px;
            border-radius: 16px;
            object-fit: cover; /* –ß—Ç–æ–±—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª–æ—Å—å */
            transition: top 0.5s ease-in-out; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –±–∞–Ω–Ω–µ—Ä–∞ */
        }
        .load-banner {
            position: absolute;
            top: 234px;
            left: 113.5px;
            width: 163px;
            height: 78px;
            object-fit: cover; /* –ß—Ç–æ–±—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª–æ—Å—å */
            transition: opacity 0.5s ease-in-out; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ */
            opacity: 1;
        }
        .title {
            position: absolute;
            top: 157px; /* –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏ –±–∞–Ω–Ω–µ—Ä–∞ */
            left: 32px;
            width: 283px;
            height: 27px;
            font-family: 'Vela Sans GX', sans-serif;
            font-weight: 700;
            font-size: 20px;
            line-height: 27.32px;
            color: #FFFFFF; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
            overflow: hidden; /* –ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π */
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: top 0.5s ease-in-out; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
        }
        .time-container {
            position: absolute;
            top: 40px; /* –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–∞–Ω–Ω–µ—Ä–∞ */
            left: 32px;
            display: flex;
            align-items: center;
            gap: 4px; /* –†–∞–∑—Ä—ã–≤ –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º */
            transition: top 0.5s ease-in-out; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ */
        }

        .time-icon {
            width: 16px;
            height: 16px;
        }

        .time-text {

            font-family: 'Vela Sans GX', sans-serif;
            font-weight: 500;
            font-size: 12px;
            line-height: 16px;
            color: #FFFFFF; /* –ë–µ–ª—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
        }

        .new-title {
            position: absolute;
            top: 32px; /* –ü–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∏–∂–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            left: 32px;
            width: 283px;
            height: 27px;
            font-family: 'Vela Sans GX', sans-serif;
            font-weight: 700;
            font-size: 20px;
            line-height: 27.32px;
            color: #FFFFFF; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
            opacity: 0; /* –°–∫—Ä—ã—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ */
            transition: opacity 0.5s ease-in-out; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        }



        .choices-container {
            position: absolute;
            top: 300px;
            left: 32px;
            width: calc(100% - 64px);
            display: flex;
            flex-direction: column;
            gap: 16px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .choice-button {
            position: relative;
            background-color: #1C1C1C;
            color: #FFFFFF;
            font-family: 'Vela Sans GX', sans-serif;
            font-weight: 500;
            font-size: 16px;
            padding: 16px;
            border: none;
            border-radius: 16px;
            text-align: left;
            cursor: pointer;
        }

        .submit-button {
            background-color: #141414;
            color: #FFFFFF;
            font-family: 'Vela Sans GX', sans-serif;
            font-weight: 700;
            font-size: 16px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 24px;
            width: 100%;
        }

</style>

    <div class="top-block">
    <img src="{{ quiz.banner.url }}" alt="{{ quiz.title }}" class="banner hidden" id="quiz-banner">
    <div class="time-container hidden" id="time-container">
        <img src="{% static 'main_page/images/vector.png' %}" alt="Timer Icon" class="time-icon">
        <div class="time-text" id="timer-text">00:00</div>
    </div>
    <div class="title hidden" id="quiz-title">Theme: {{ quiz.title }}</div>
    <div class="new-title hidden" id="new-quiz-title">{{ quiz.questions.first.text }}</div>
    <div class="choices-container hidden" id="choices-container">
        {% for choice in quiz.questions.first.choice.all %}
        <button type="button" class="choice-button">{{ choice.text }}</button>
        {% endfor %}
        <button type="button" class="submit-button hidden" id="submit-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
</div>
<div class="container" id="loading-container">
    <img src="{% static 'quiz/images/Frame 17.png'%}" class="load-banner" id="load-banner">
</div>


<script>
    window.addEventListener('load', () => {
    const loadingContainer = document.getElementById('loading-container');
    const loadBanner = document.getElementById('load-banner');
    const quizBanner = document.getElementById('quiz-banner');
    const quizTitle = document.getElementById('quiz-title');
    const timeContainer = document.getElementById('time-container');
    const newQuizTitle = document.getElementById('new-quiz-title');
    const choicesContainer = document.getElementById('choices-container');
    const submitButton = document.getElementById('submit-button');
    const timerText = document.getElementById('timer-text');

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞–º–∏
    let currentQuestionIndex = 0;
    const questions = [
        {% for question in quiz.questions.all %}
            {
                text: "{{ question.text }}",
                is_multiple_choice: {{ question.is_multiple_choice|yesno:"true,false" }},
                choices: [
                    {% for choice in question.choice.all %}
                        "{{ choice.text }}",
                    {% endfor %}
                ],
                timeLimit: {{ question.time_limit }}
            },
        {% endfor %}
    ];

    let timerInterval;  // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞
    function updateQuestion() {
        if (currentQuestionIndex < questions.length) {
            const currentQuestion = questions[currentQuestionIndex];
            newQuizTitle.textContent = currentQuestion.text;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            choicesContainer.innerHTML = '';
            currentQuestion.choices.forEach(choiceText => {
                const choiceButton = document.createElement('button');
                choiceButton.className = 'choice-button';
                choiceButton.textContent = choiceText;

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç—É –æ—Ç–≤–µ—Ç–∞
                choiceButton.addEventListener('click', () => {
                    if (currentQuestion.is_multiple_choice) {
                        // –ï—Å–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å
                        choiceButton.classList.toggle('selected');
                    } else {
                        // –ï—Å–ª–∏ –æ–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä, —Å–Ω–∏–º–∞–µ–º –∫–ª–∞—Å—Å —Å –¥—Ä—É–≥–∏—Ö –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫ —Ç–µ–∫—É—â–µ–º—É
                        const allChoices = document.querySelectorAll('.choice-button');
                        allChoices.forEach(button => button.classList.remove('selected'));
                        choiceButton.classList.add('selected');
                    }
                });

                choicesContainer.appendChild(choiceButton);
            });
            choicesContainer.appendChild(submitButton); // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä —Å –Ω–æ–≤—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
            let remainingTime = currentQuestion.timeLimit;
            timerText.textContent = `${Math.floor(remainingTime / 60)} : ${remainingTime % 60 < 10 ? '0' : ''}${remainingTime % 60}`;
            clearInterval(timerInterval); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            timerInterval = setInterval(() => {
                if (remainingTime > 0) {
                    remainingTime--;
                    const minutes = Math.floor(remainingTime / 60);
                    const seconds = remainingTime % 60;
                    timerText.textContent = `${minutes} : ${seconds < 10 ? '0' : ''}${seconds}`;
                } else {
                    clearInterval(timerInterval); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ
                    submitButton.click(); // –ö–ª–∏–∫–∞–µ–º –ø–æ –∫–Ω–æ–ø–∫–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
                }
            }, 1000);
        } else {
            // –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ–π–¥–µ–Ω—ã
            newQuizTitle.textContent = '–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∫–≤–∏–∑!';
            choicesContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
    submitButton.addEventListener('click', () => {
        currentQuestionIndex++;
        updateQuestion(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
    if (loadingContainer && loadBanner) {

        setTimeout(() => {
            if (quizBanner) {
                quizBanner.style.top = '82px';
            }
            if (quizTitle) {
                quizTitle.style.top = '223px';
            }
            if (timeContainer) {
                timeContainer.style.top = '106px';
            }
            if (newQuizTitle) {
                setTimeout(() => {
                    newQuizTitle.style.opacity = '1';
                    updateQuestion(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
                }, 500);
            }
            if (choicesContainer) {
                setTimeout(() => {
                    choicesContainer.style.opacity = '1';
                }, 1500);
            }
        }, 500);
    }
});
</script>
 <script>
        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WebSocket
const quizId = window.location.pathname.split('/')[2];
const socket = new WebSocket(`ws://${window.location.host}/ws/quiz/${quizId}/`);

socket.onopen = function() {
    console.log("‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å WebSocket —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ");
};

socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    if (data.type === 'quiz_update') {
        document.getElementById('question-text').textContent = data.question || "–í–æ–ø—Ä–æ—Å—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!";
        startTimer(data.remaining_time);
    }

    if (data.type === 'quiz_end') {
        alert(data.message);
    }
    if (data.type === "start_quiz") {
        console.log(`üì¢ –ö–≤–∏–∑ ${data.quiz_id} –Ω–∞—á–∞—Ç!`);

        // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Ä—Ü–∞–Ω–∏–µ –∏ —Å–∫—Ä—ã—Ç—å –±–∞–Ω–Ω–µ—Ä
        const loadBanner = document.getElementById('load-banner');
        const loadingContainer = document.getElementById('loading-container');
        if (loadBanner) {
            loadBanner.style.animation = 'none'; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            loadBanner.style.opacity = '0'; // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–æ 0
        }
        if (loadingContainer) {
            setTimeout(() => {
                loadingContainer.style.display = 'none'; // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç—å
            }, 500); // –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∫–≤–∏–∑–∞
        const elementsToShow = [
            document.getElementById('quiz-banner'),
            document.getElementById('time-container'),
            document.getElementById('quiz-title'),
            document.getElementById('new-quiz-title'),
            document.getElementById('choices-container'),
            document.getElementById('submit-button')
        ];

        elementsToShow.forEach(element => {
            if (element) element.classList.remove('hidden');
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
        updateQuestion();
    }
};


    </script>

{% endblock %}
